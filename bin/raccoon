#!/usr/bin/env ruby

require 'optparse'
require_relative '../lib/raccoon'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: raccoon [options]"

  opts.on('--help', 'Show help message') { options[:help] = true }
  opts.on('-h TARGET', 'Set the target for scanning') { |target| options[:target] = target }
  opts.on('-n TARGET', 'Run a normal scan on the target') do |target|
    options[:scan_type] = :normal
    options[:target] = target
  end
  opts.on('-l TARGET', 'Run a less aggressive scan on the target') do |target|
    options[:scan_type] = :less_aggressive
    options[:target] = target
  end
  opts.on('-a TARGET', 'Run an aggressive scan on the target') do |target|
    options[:scan_type] = :aggressive
    options[:target] = target
  end
  opts.on('-r SCAN_ID', 'Generate a report for the given scan ID') { |scan_id| options[:report] = scan_id }
  opts.on('-o OUTPUT_DIR', 'Specify output directory for scan results') { |dir| options[:output_dir] = dir }
end.parse!

raccoon = Raccoon.new

case
when options[:help]
  raccoon.help
when options[:target] && options[:scan_type]
  raccoon.scan(options[:scan_type], options[:target], options[:output_dir])
when options[:report]
  raccoon.generate_report(options[:report])
when options[:target]
  raccoon.set_target(options[:target])
else
  puts "Unknown command. Use --help for a list of commands."
end
